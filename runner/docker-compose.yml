# Docker Compose for Cloakium self-hosted GitHub Actions runner (Linux)
#
# Usage:
#   1. Get a runner registration token:
#      gh api repos/cloakium/cloakium/actions/runners/registration-token -q .token
#
#   2. Create .env:
#      RUNNER_TOKEN=<token>
#
#   3. Start:
#      docker compose up -d --build
#
# Persistent bind mounts on the host:
#   /data/github-runner/cache → /cache  (depot_tools)
#   /data/github-runner/work  → /work   (Chromium source + build output)

services:
  runner:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      GITHUB_REPO: cloakium/cloakium
      RUNNER_TOKEN: ${RUNNER_TOKEN}
      RUNNER_NAME: cloakium-linux-01
      RUNNER_LABELS: self-hosted,linux,x64
      CACHE_ROOT: /cache
      WORK_ROOT: /work
      MINIO_ENDPOINT: ${MINIO_ENDPOINT:-}
      MINIO_ACCESS_KEY: ${MINIO_ACCESS_KEY:-}
      MINIO_SECRET_KEY: ${MINIO_SECRET_KEY:-}
    volumes:
      - /data/github-runner/cache:/cache
      - /data/github-runner/work:/work
    network_mode: host
    restart: unless-stopped
